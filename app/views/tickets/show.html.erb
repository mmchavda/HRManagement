<div class="container mx-auto px-6 py-10">
  <div class="max-w-6xl mx-auto">
    <!-- Top Buttons -->
    <div class="flex flex-wrap justify-between items-center gap-4 mb-6">
      <%= link_to 'Back to Tickets', tickets_path, class: 'bg-gray-800 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition' %>
      <div class="flex flex-wrap gap-4">
        <%= link_to 'Update Ticket', edit_ticket_path(@ticket), class: 'bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition' %>
        <%= link_to 'View Audit History', audit_history_ticket_path(@ticket), class: 'bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition' %>
        <%= link_to 'Add Note', new_note_ticket_path(@ticket), class: 'bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition' %>
        <%= link_to 'View Notes', notes_ticket_path(@ticket), class: 'bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition' %>
      </div>
    </div>

    <!-- Ticket Details Card -->
    <div class="bg-white shadow-xl rounded-2xl overflow-hidden">
      <div class="bg-gray-200 px-6 py-4 border-b">
        <h2 class="text-2xl font-semibold text-gray-800">Ticket Details</h2>
      </div>
      <div class="p-6 space-y-8">

        <!-- General Details -->
        <div>
          <h3 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">General Details</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <p><span class="font-semibold text-gray-800">Title:</span> <%= @ticket.title %></p>
            </div>
            <div>
              <p><span class="font-semibold text-gray-800">Status:</span> <%= @ticket.status %></p>
            </div>
            <div>
              <p><span class="font-semibold text-gray-800">Priority:</span> <%= @ticket.priority %></p>
            </div>
            <div>
              <p><span class="font-semibold text-gray-800">Description:</span> <%= @ticket.description %></p>
            </div>
          </div>
        </div>

        <!-- User Assignment -->
        <div>
          <h3 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">User Assignment</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <p><span class="font-semibold text-gray-800">Assigned To:</span> 
                <%= @ticket.assigned_user&.full_name %> 
                (<%= @ticket.assigned_user&.email %>)
              </p>
            </div>
          </div>

          <% if (current_user.admin? || current_user.hr?) %>
            <% @hr_or_admin_users = User.where(role: ['hr', 'admin']).where.not(id: @ticket.assigned_user_id) %>
            <%= form_with(model: @ticket, url: assign_ticket_path(@ticket), method: :patch, local: true) do |form| %>
              <div class="flex w-full">
                <!-- Left side: Select dropdown -->
                <div class="w-1/2 pr-4">
                  <strong class="text-black text-lg font-semibold mr-2"> <!-- Added margin-right -->
                    <%= form.select :assigned_user_id, options_from_collection_for_select(@hr_or_admin_users, :id, :email), include_blank: 'Select User', class: 'form-select text-sm w-full' %>
                  </strong>
                </div>
        
                <!-- Right side: Submit button -->
                <div class="w-1/2 pl-4">
                  <p class="text-black text-lg text-left">
                    <%= form.submit 'Assign', class: 'px-4 py-2' %>
                  </p>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>